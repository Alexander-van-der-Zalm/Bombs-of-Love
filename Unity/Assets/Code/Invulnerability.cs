using UnityEngine;
using System.Collections;

public class Invulnerability : MonoBehaviour
{
    public float MidAlpha = 0.65f;
    public float RespawnInvulnerableTime = 3.0f;
    public int Pulses = 8;

    private Health health;
    private SpriteRenderer rndr;

    void Awake()
    {
        health = GetComponent<Health>();
        rndr = GetComponent<SpriteRenderer>();
    }

    public void StartInvulnerability()
    {
        StartCoroutine(InvulnerabilityCR());
    }

    private IEnumerator InvulnerabilityCR()
    {
        float time = 0;
        health.Invulnerable = true;

        while (time < RespawnInvulnerableTime)
        {
            time += Time.deltaTime;
            // Alpha effect
            float alpha = 1 - ((1 - MidAlpha) * Mathf.Sin(time * Mathf.PI * Pulses / RespawnInvulnerableTime));
            rndr.color = new Color(rndr.color.r, rndr.color.g, rndr.color.b, alpha);
            
            yield return null;
        }

        InvulnerableReset();
    }

    public void InvulnerableReset()
    {
        health.Invulnerable = false;
        rndr.color = new Color(rndr.color.r, rndr.color.g, rndr.color.b, 1);
    }
}
